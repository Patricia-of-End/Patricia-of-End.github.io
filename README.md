# ローカルメディアプレイヤー

ブラウザで動作する、高機能なローカルオーディオファイルプレイヤーです。ローカルにある音楽ファイルを読み込み、メタデータや同期歌詞、オーディオビジュアライザーと共に楽しむことができます。

## 主な機能

-   **ローカルファイル再生:** お使いのコンピュータから直接、音声ファイル（MP3, WAV, FLACなど）を選択して再生できます。
-   **高度なファイル情報解析:**
    * 音声ファイルに埋め込まれたタグ情報（曲名、アーティスト、アルバム、アルバムアート）を自動で読み込み、表示します。**WAVファイルの非標準的なID3タグ（ID3v2.3/2.4 RIFF）やLIST INFOチャンクからのメタデータ抽出にも対応**しています。
    * ファイルの形式、**サンプリングレート（ファイル固有およびAudioContext）、ビットレート、ビット深度、チャンネル数**、ファイルサイズなどの詳細情報を表示します。
-   **同期歌詞表示:**
    * 音声ファイル埋め込みのLRC形式の歌詞を自動で表示します。
    * 外部の `.lrc` ファイルを個別に読み込んで表示することも可能です。
    * 表示されている歌詞の行をクリックすると、その時間まで再生位置がジャンプします。
-   **高機能オーディオビジュアライザー:**
    * 再生中の音声の周波数スペクトルをリアルタイムで視覚化します。
    * **再生ファイルのサンプリング周波数と再生デバイス（AudioContext）の周波数を考慮し、オーディオ情報が存在する周波数帯域を自動で均等に割り付けて表示**します。
-   **オーディオエフェクト（デジタルシグナルプロセッサ - DSP）:**
    * **グラフィックイコライザー:** 10バンドのイコライザーで、細かく周波数バランスを調整できます。プリセットも利用可能です。
    * **トーンコントロール:** バス（低音）とトレブル（高音）を独立して調整できます。
    * **ステレオ拡張:** 音場の広がりを調整し、より臨場感のあるサウンドを実現します。
    * **アンビエンス（リバーブ）:** 残響効果を付与し、音場感を調整できます。プリセットも利用可能です。
    * **ボーカルカット:** ボーカル成分を減衰させ、カラオケ用途などに利用できます。
-   **標準的なプレイヤー機能:**
    * 再生/一時停止
    * シークバーによる再生位置の変更
    * 音量調整
-   **キーボード・ゲームパッド操作:** 基本的な再生操作はキーボードやゲームパッドからも可能です。

## 使用技術

-   **フロントエンド:**
    * HTML5
    * CSS3
    * JavaScript (ES Modules)
    
-   **ライブラリ/フレームワーク:**
    * [Tailwind CSS](https://tailwindcss.com/) (CDN経由): UIのスタイリング
    * [Web Audio API](https://developer.mozilla.org/ja/docs/Web/API/Web_Audio_API): オーディオ処理グラフ構築（`MediaElementSourceNode`, `AnalyserNode`, `BiquadFilterNode`, `GainNode`, `ConvolverNode`, `DelayNode`, ``ChannelSplitterNode`, `ChannelMergerNode` など）
    * [Media Session API](https://developer.mozilla.org/ja/docs/Web/API/Media_Session_API): メディア通知とメディアキー操作
    * [heroicons v2.1.5](https://heroicons.com/): UIアイコンのセット
    * [jsmediatags](https://github.com/aadsm/jsmediatags): 音声ファイルのメタデータ読み込み（MP3/FLAC/M4Aなど）

## セットアップと使い方

このプロジェクトをローカル環境で実行するには、Node.js と npm が必要です。

1.  **リポジトリのクローンまたはダウンロード:**
    まず、このプロジェクトのファイルをコンピュータにダウンロードします。

2.  **依存パッケージのインストール:**
    プロジェクトのルートフォルダ（`package.json` がある場所）でコマンドプロンプトまたはターミナルを開き、以下のコマンドを実行します。
    ```sh
    npm install
    ```

3.  **ローカル開発サーバーの起動:**
    同じくコマンドプロンプトで、以下のコマンドを実行して開発サーバーを起動します。
    ```sh
    npm run server
    ```
    または、プロジェクトルートにある `start_server.bat` (Windowsの場合) をダブルクリックして実行することもできます。

4.  **ブラウザで開く:**
    サーバーが起動すると、自動的にブラウザが開いて `http://127.0.0.1:8080` のようなアドレスでアプリケーションが表示されます。表示されない場合は、コマンドプロンプトに表示されたアドレスに手動でアクセスしてください。

## ファイル構成

このプロジェクトのJavaScriptコードは、保守性を高めるために機能ごとにファイル分割されています。

/
├── js/
│   ├── main.js                 # 全体の初期化とイベントリスナー登録
│   ├── domElements.js          # DOM要素の取得
│   ├── utils.js                # 汎用ヘルパー関数（時間/ファイルサイズフォーマットなど）
│   ├── ui.js                   # UI更新関連（メタデータ、ファイル情報、時間表示など）
│   ├── audioHandler.js         # 音声ファイルの読み込み、再生ロジック、グローバルなファイル情報管理
│   ├── audioHeaderParser.js    # WAV/FLACファイルのヘッダーから詳細情報やメタデータを解析
│   ├── lyricsHandler.js        # 歌詞関連の処理（LRCファイルの読み込み、同期、表示）
│   ├── visualizer.js           # オーディオビジュアライザー関連（Canvas描画、AudioContextグラフ、DSP）
│   ├── mediaSessionHandler.js  # Media Session API 関連（メディア通知、メディアキー制御）
│   ├── inputHandler.js         # キーボード、ゲームパッド入力の処理
│   ├── eq-presets.js           # イコライザープリセットデータ
│   └── ambience-presets.js     # アンビエンスプリセットデータ
├── index.html                  # メインのHTMLファイル
├── style.css                   # カスタムスタイル
└── package.json                # プロジェクト設定と依存関係
